<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

    <link href="F:\GitUnity\GitHub\frontend\MyComponents\style.css" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">

    </head>
    <body>
      
      <div class="container-fluid">
        <div class="row">
          <!-- Оставляем один экземпляр разметки компонента -->
          <div class="col-sm-6 mb-3 mb-sm-0">
              <div class="card">
                  <!-- код заголовка карточки -->
                  <div class="card-header bg-primary-subtle">
                    <h3 class="card-title">Установка периода</h3>
                    <p class="card-text"></p>
                  </div>
                  <div class="card-body">
                      <!-- код стандартного периода -->
                      <div class="row mb-3">
                        <h5>Стандартный период</h5>
                        <div class="col-6">
                          <label for="standard-year" class="form-label">Год:</label>
                          <input type="number" id="standard-year" class="form-control" placeholder="Год" min="1900" max="2099" step="1">
                        </div>
                        <div class="col-6">
                          <label for="standard-period" class="form-label">Период/Месяц:</label>
                          <select id="standard-period" class="form-select">
                            <option value="">Выберите период</option>
                            <option value="full-year">Год</option>
                            <option value="first-half">Первое полугодие</option>
                            <option value="second-half">Второе полугодие</option>
                            <option value="first-quarter">Первый квартал</option>
                            <option value="second-quarter">Второй квартал</option>
                            <option value="third-quarter">Третий квартал</option>
                            <option value="fourth-quarter">Четвёртый квартал</option>
                            <option value="nine-months">Девять месяцев</option>
                            <option value="01">Январь</option>
                            <option value="02">Февраль</option>
                            <option value="03">Март</option>
                            <option value="04">Апрель</option>
                            <option value="05">Май</option>
                            <option value="06">Июнь</option>
                            <option value="07">Июль</option>
                            <option value="08">Август</option>
                            <option value="09">Сентябрь</option>
                            <option value="10">Октябрь</option>
                            <option value="11">Ноябрь</option>
                            <option value="12">Декабрь</option>
                          </select>
                        </div>
                    </div>
                      <div class="row mb-3">
                          <!-- код произвольного периода, добавляем классы для инициализации плагинов -->
                          <h5>Произвольный период</h5>
                          <div class="col-6">
                            <label for="custom-start-date" class="form-label">Начало периода:</label>
                            <input type="text" id="custom-start-date" class="form-control" placeholder="ДД.ММ.ГГГГ">
                          </div>
                          <div class="col-6">
                            <label for="custom-end-date" class="form-label">Конец периода:</label>
                            <input type="text" id="custom-end-date" class="form-control" placeholder="ДД.ММ.ГГГГ">
                          </div>
                      </div>
                      <!-- код кнопок Ок и Отмена -->
                      <div class="mb-3">
                        <button id="btn-ok" class="btn btn-outline-secondary">Ок</button>
                        <button id="btn-cancel" class="btn btn-outline-secondary">Отмена</button>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.ru.min.js"></script>

      <script src="F:\GitUnity\GitHub\frontend\MyComponents\scripts\main.js"></script>
    </body>
</html>

$(document).ready(function(){
  // Инициализация Inputmask для произвольного периода с немедленным форматированием
  $("#custom-start-date, #custom-end-date").inputmask("dd.mm.yyyy", {
      "placeholder": "дд.мм.гггг",
      insertMode: false,
      showMaskOnHover: false,
      clearIncomplete: true,
      greedy: false, // Добавить эту опцию
      definitions: {
          'd': {
              validator: "[0-9]",
              cardinality: 1,
              prevalidator: null
          },
          'm': {
              validator: "[0-9]",
              cardinality: 1,
              prevalidator: null
          },
          'y': {
              validator: "[0-9]",
              cardinality: 1,
              prevalidator: null
          }
      },
      onKeyPress: function (value, event, currentField, options) {
          // Автоматическое добавление точек при вводе
          var matches = value.match(/(\d{2})(\d{2})?(\d{4})?/);
          if (matches) {
              if(matches[2]) {
                  var day_month = matches[1] + '.' + matches[2];
                  if(matches[3]) {
                      day_month += '.' + matches[3].substr(0,2);
                  }
                  currentField.val(day_month);
              }
              if(matches[2] && matches[3] && matches[3].length == 2) {
                  // Добавляем последние две цифры года и обновляем поле сразу
                  var dateWithYear = value + matches[3].substr(2,2);
                  currentField.val(dateWithYear);
              }
          }
      }
  });

// Иконка календаря для открытия datepicker
$('.bi-calendar3').click(function() {
  $('#datepicker').datepicker('show');
});
});
$(document).ready(function(){
// Инициализация datepicker для произвольного периода
$('#custom-start-date, #custom-end-date').datepicker({
format: 'dd.mm.yyyy',
language: 'ru',
autoclose: true,
todayHighlight: true
});

// События изменения в стандартном периоде
$('#standard-year').on('input', function() {
var year = $(this).val();
if (year.length == 4) {
  updateCustomPeriodDates(year, $('#standard-period').val());
}
});

$('#standard-period').change(function() {
var year = $('#standard-year').val();
var period = $(this).val();
updateCustomPeriodDates(year, period);
});

// Функция обновляет даты в произвольном периоде
function updateCustomPeriodDates(year, period) {
  var startDate, endDate;

  if (year) {
      switch (period) {
          case "full-year":
              startDate = `01.01.${year}`;
              endDate = `31.12.${year}`;
              break;
          case "first-half":
              startDate = `01.01.${year}`;
              endDate = `30.06.${year}`;
              break;
          case "second-half":
              startDate = `01.07.${year}`;
              endDate = `31.12.${year}`;
              break;
          case "first-quarter":
              startDate = `01.01.${year}`;
              endDate = `31.03.${year}`;
              break;
          case "second-quarter":
              startDate = `01.04.${year}`;
              endDate = `30.06.${year}`;
              break;
          case "third-quarter":
              startDate = `01.07.${year}`;
              endDate = `30.09.${year}`;
              break;
          case "fourth-quarter":
              startDate = `01.10.${year}`;
              endDate = `31.12.${year}`;
              break;
          case "nine-months":
              startDate = `01.01.${year}`;
              endDate = `30.09.${year}`;
              break;
          default:
              // Если период - это месяц (01-12)
              if (!isNaN(period) && period >=1 && period <=12) {
                  var paddedPeriod = period.padStart(2, '0');
                  startDate = `01.${paddedPeriod}.${year}`;
                  // Определение последнего дня месяца
                  var endDay = new Date(year, period, 0).getDate();
                  endDate = `${endDay < 10 ? '0' + endDay : endDay}.${paddedPeriod}.${year}`;
              }
              break;
      }
  
      // Обновление datepicker с новыми значениями
      if (startDate && endDate) {
          $('#custom-start-date').datepicker('update', startDate);
          $('#custom-end-date').datepicker('update', endDate);
      }
  }
}


// Обработчики кнопок "Ок" и "Отмена"
$('#btn-ok').click(function() {
// Ваша логика для кнопки "Ок"
});

$('#btn-cancel').click(function() {
// Ваша логика для кнопки "Отмена"
});
});